/* Edit Modal Specific */
/* Fix edit modal layout - keep header/footer fixed, only body scrolls */
.edit-modal {
    max-width: 1000px;
    width: 95%;
    max-height: 95vh;
    display: flex;
    flex-direction: column;
}

.edit-modal .modal-header {
    flex-shrink: 0; /* Fixed header */
}

.edit-modal .modal-body {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

.edit-modal .modal-footer {
    flex-shrink: 0; /* Fixed footer */
}

/* Modern Character Edit Modal */
.character-header {
    display: flex;
    align-items: flex-start;
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
    padding: var(--space-lg);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
}

/* Avatar Area with better spacing and layout */
.avatar-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    width: 120px;
    height: 180px;
    flex-shrink: 0;
    padding: var(--space-sm);
    margin-top: -12px;  /* ADD THIS LINE - adjust the value to move it more/less */
}

.avatar-section {
    position: relative;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 1;
}

.avatar-section {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    justify-content: center;
}

.avatar-preview-container {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.avatar-nav-btn {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    color: var(--text-secondary);
    cursor: pointer;
    padding: var(--space-xs);
    border-radius: var(--radius-sm);
    width: 18px;  /* Reduced from 28px */
    height: 18px;  /* Reduced from 28px */
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;  /* Reduced from 12px */
    transition: all var(--transition-normal);
}

.avatar-nav-btn:hover {
    background: var(--bg-hover);
    color: var(--accent-primary);
    border-color: var(--accent-primary);
}

.avatar-counter {
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 10px;
    color: var(--text-tertiary);
    background: var(--bg-tertiary);
    padding: 2px 6px;
    border-radius: var(--radius-xs);
    white-space: nowrap;
}

.avatar-preview {
    width: 90px;
    height: 150px;  /* Increased from 110px */
    border-radius: var(--radius-lg);
    background: var(--bg-tertiary);
    border: 2px solid var(--border-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    transition: all var(--transition-normal);
}

.avatar-preview:hover {
    border-color: var(--accent-primary);
}

.avatar-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-preview i {
    font-size: 28px;
    color: var(--text-tertiary);
}

.btn-ghost {
    position: absolute;
    bottom: -6px;
    right: -4px;  /* Moved further right from -8px */
    width: 28px;  /* Reduced from 28px */
    height: 22px;  /* Reduced from 28px */
    border-radius: 50%;
    background: var(--accent-primary);
    color: white;
    border: 2px solid var(--bg-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;  /* Reduced from 12px */
    cursor: pointer;
    transition: all var(--transition-normal);
}

#change-avatar-btn {
    width: 28px !important;
    height: 22px !important;
    right: -12px;
    bottom: -6px;
    font-size: 10px;
    padding: 0 !important;  /* ADD THIS LINE */
}

.btn-ghost:hover {
    background: var(--accent-secondary);
}

.token-summary {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--accent-primary);
    background: var(--bg-tertiary);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-secondary);
    white-space: nowrap;
    margin-top: auto;
    flex-shrink: 0;
}

/* Character Basic Info */
.character-basic {
    flex: 1;
}

.name-row {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: var(--space-lg);
    margin-bottom: var(--space-lg);
}

.edit-input.primary {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
}

/* Collapsible Tags */
.tags-header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    cursor: pointer;
    user-select: none;
    transition: all var(--transition-normal);
}

.tags-header:hover {
    color: var(--accent-primary);
}

.tags-header label {
    margin: 0;
    cursor: pointer;
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-labels);
}

.tags-toggle {
    font-size: 10px;
    color: var(--text-tertiary);
    transition: all var(--transition-normal);
}

.tags-toggle.expanded {
    transform: rotate(180deg);
}

.tags-input-area {
    overflow: hidden;
    transition: all var(--transition-normal);
    margin-top: var(--space-xs);
}

.tags-input-area.collapsed {
    max-height: 0;
    margin-top: 0;
}

.tags-input-area:not(.collapsed) {
    max-height: 100px;
}

/* Modern Tag Chips */
.tag-chips {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-xs);
    margin-top: var(--space-xs);
}

.tag-chip {
    background: var(--accent-secondary);
    color: var(--text-primary);
    padding: 2px var(--space-xs);
    border-radius: var(--radius-md);
    font-size: 10px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    transition: all var(--transition-normal);
    cursor: pointer;
}

.tag-chip:hover {
    background: var(--accent-primary);
}

.tag-chip .remove-tag {
    cursor: pointer;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    transition: all var(--transition-normal);
}

.tag-chip .remove-tag:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* Content Sections */
.content-sections {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
}

.content-section {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
}

.content-section h4 {
    margin: 0 0 var(--space-md) 0;
    color: var(--text-primary);
    font-size: var(--font-size-base);
    font-weight: 600;
    padding-bottom: var(--space-sm);
    border-bottom: 1px solid var(--border-primary);
}

.section-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-lg);
    margin-bottom: var(--space-lg);
}

/* Form Elements */
.form-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

.form-group label {
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-labels);
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
}

.token-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-tertiary);
    background: var(--bg-tertiary);
    padding: 2px 6px;
    border-radius: var(--radius-xs);
    margin-left: auto;
}

.expand-btn {
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: var(--space-xs);
    border-radius: var(--radius-sm);
    transition: all var(--transition-normal);
    font-size: 11px;
}

.expand-btn:hover {
    color: var(--accent-primary);
    background: var(--bg-hover);
}

.edit-input,
.edit-textarea,
.edit-select {
    padding: var(--space-sm) var(--space-md);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-inputs);
    font-family: inherit;
    transition: all var(--transition-normal);
    resize: vertical;
}

.edit-input:focus,
.edit-textarea:focus,
.edit-select:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 2px rgba(184, 149, 107, 0.1);
}

.edit-textarea {
    font-family: 'JetBrains Mono', monospace;
    font-size: var(--font-size-sm);
    line-height: 1.5;
}

/* Legacy textarea sizes (kept for compatibility) */
.edit-textarea.small {
    min-height: 80px;
    resize: vertical;
}

.edit-textarea.medium {
    min-height: 100px;
    resize: vertical;
}

.edit-textarea.large {
    min-height: 120px;
    resize: vertical;
}

/* Character Note Controls */
.character-note-group {
    position: relative;
}

.character-note-controls {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-top: var(--space-xs);
    justify-content: flex-start;
}

.character-note-controls label {
    margin: 0;
    font-size: var(--font-size-xs);
    flex-shrink: 0;
}

.depth-input {
    width: 60px;
    padding: var(--space-xs);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-sm);
    background-color: var(--bg-tertiary);
    color: var(--text-primary);
    text-align: center;
    font-size: var(--font-size-sm);
    flex-shrink: 0;
}

.character-note-controls .small-btn {
    margin-top: 0;
    margin-left: var(--space-md);
}

/* Small Buttons */
.small-btn {
    align-self: flex-start;
    margin-top: var(--space-xs);
    margin-bottom: var(--space-sm);
    padding: var(--space-xs) var(--space-sm);
    font-size: var(--font-size-xs);
}

/* Full width fields */
.form-group.full-width {
    grid-column: 1 / -1;
    margin-bottom: var(--space-lg);
}

/* Advanced section specific styling */
.form-group.full-height {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.form-group.full-height .edit-textarea {
    flex: 1;
    min-height: 120px;
}

.advanced-right-column {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
}

/* Legacy form container (kept for compatibility) */
.edit-form-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-xl);
}

.edit-column {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
}

/* Special Buttons (legacy) */
.special-buttons {
    display: flex;
    gap: var(--space-md);
}

.special-buttons button {
    flex: 1;
    min-width: 160px;
}

/* Total Token Display (legacy) */
.total-token-display {
    background-color: var(--bg-quaternary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-sm);
    padding: var(--space-md);
    text-align: center;
    margin-top: var(--space-md);
}

.total-token-display strong {
    font-family: 'JetBrains Mono', monospace;
    color: var(--accent-primary);
}

/* Modal Footer Specific */
.folder-assignment {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.folder-assignment label {
    margin: 0;
    font-size: var(--font-size-sm);
    color: var(--text-labels);
}

.modal-actions {
    display: flex;
    gap: var(--space-md);
}

/* ALT Button Styling */
.alt-btn {
    background: none;
    border: 1px solid var(--border-tertiary);
    color: var(--text-tertiary);
    cursor: pointer;
    padding: 2px 6px;
    border-radius: var(--radius-sm);
    font-size: 10px;
    font-weight: 500;
    font-family: inherit;
    transition: all var(--transition-normal);
    margin-left: var(--space-xs);
    height: 18px;
    line-height: 1;
}

.alt-btn:hover {
    color: var(--accent-primary);
    border-color: var(--accent-primary);
    background: rgba(184, 149, 107, 0.1);
}

.alt-btn.has-alternates {
    color: var(--accent-primary);
    border-color: var(--accent-primary);
    background: rgba(184, 149, 107, 0.1);
}

/* Alternates Modal */
.alternates-modal {
    max-width: 700px;
    width: 90%;
    max-height: 80vh;
}

.alternates-list {
    max-height: 400px;
    overflow-y: auto;
    margin-bottom: var(--space-lg);
}

.alternate-item {
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    margin-bottom: var(--space-md);
    position: relative;
}

.alternate-item.active {
    border-color: var(--accent-primary);
    background-color: rgba(184, 149, 107, 0.05);
}

.alternate-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-sm);
}

.alternate-name {
    font-weight: 500;
    color: var(--text-primary);
}

.alternate-actions {
    display: flex;
    gap: var(--space-xs);
}

.alternate-actions button {
    padding: var(--space-xs);
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.alternate-content {
    background: var(--bg-primary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-sm);
    padding: var(--space-sm);
    font-family: 'JetBrains Mono', monospace;
    font-size: var(--font-size-sm);
    line-height: 1.4;
    color: var(--text-secondary);
    max-height: 60px;
    overflow-y: auto;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
}

.alternate-content.empty {
    color: var(--text-tertiary);
    font-style: italic;
}

.add-alternate-section {
    text-align: center;
    padding-top: var(--space-lg);
    border-top: 1px solid var(--border-primary);
}

/* Greetings Modal */
/* Greetings Modal */
.greetings-modal {
    max-width: 700px;
    width: 90%;
    max-height: 80vh;
}

.greetings-info {
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    margin-bottom: var(--space-lg);
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
}

.greetings-list {
    max-height: 400px;
    overflow-y: auto;
    margin-bottom: var(--space-lg);
}

.greeting-item {
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-md);
    padding: var(--space-sm) var(--space-md);
    margin-bottom: var(--space-md);
}

.greeting-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-xs);
}

.greeting-label {
    font-weight: 500;
    color: var(--text-primary);
    font-size: var(--font-size-sm);
}

.greeting-header button {
    padding: var(--space-xs);
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.greeting-header .token-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-tertiary);
    background: var(--bg-quaternary);
    padding: 2px 6px;
    border-radius: var(--radius-xs);
}

.greeting-content {
    background: var(--bg-primary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-sm);
    padding: var(--space-sm);
    font-family: 'JetBrains Mono', monospace;
    font-size: var(--font-size-sm);
    line-height: 1.4;
    color: var(--text-secondary);
    max-height: 60px;
    overflow-y: auto;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
    margin-bottom: var(--space-sm);
}

.greeting-content.empty {
    color: var(--text-tertiary);
    font-style: italic;
}

.greeting-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.greeting-actions {
    display: flex;
    gap: var(--space-xs);
}

.greeting-actions button {
    padding: var(--space-xs);
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.empty-greetings {
    text-align: center;
    padding: var(--space-xl);
    color: var(--text-tertiary);
}

.empty-greetings i {
    font-size: 32px;
    margin-bottom: var(--space-md);
    opacity: 0.5;
}

.empty-greetings p {
    margin: 0 0 var(--space-xs) 0;
    font-size: var(--font-size-base);
}

.empty-greetings small {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
}

.add-greeting-section {
    text-align: center;
    padding-top: var(--space-lg);
    border-top: 1px solid var(--border-primary);
}

#alt-greetings-btn.has-alternates {
    color: var(--accent-primary);
    border-color: var(--accent-primary);
    background: rgba(184, 149, 107, 0.1);
}

/* Character Book Modal - FIXED LAYOUT */
.book-modal {
    max-width: 900px;
    width: 90%;
    max-height: 85vh;
    display: flex;
    flex-direction: column;
}

.book-modal .modal-header {
    flex-shrink: 0; /* Fixed header */
}

.book-modal .modal-body {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
}

.book-modal .modal-footer {
    flex-shrink: 0; /* Fixed footer */
}

/* Book settings - now scrollable with content */
.book-settings {
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    flex-shrink: 0; /* Don't compress */
}

.setting-row {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-sm);
}

.setting-row:last-child {
    margin-bottom: 0;
}

.setting-row label {
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-labels);
    min-width: 100px;
}

.setting-row input {
    flex: 1;
}

/* Entries list - scrollable within modal body */
.entries-list {
    flex: 1;
    min-height: 0; /* Allow shrinking */
}

.add-entry-section {
    flex-shrink: 0;
    text-align: center;
    padding-top: var(--space-lg);
    border-top: 1px solid var(--border-primary);
}

/* Simplified entry item - removed duplicate header */
.entry-item {
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    margin-bottom: var(--space-md);
}

/* Remove the old entry-header since comment is already in the content */
.entry-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

.entry-row {
    display: flex;
    align-items: flex-start;
    gap: var(--space-sm);
}

.entry-row.with-logic {
    display: grid;
    grid-template-columns: 100px 1fr 120px; /* Fixed width for logic dropdown */
    gap: var(--space-sm);
    align-items: center;
}

.entry-row.full-width {
    grid-column: 1 / -1;
}

.entry-row label {
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-labels);
    min-width: 100px;
    margin-top: var(--space-xs);
}

.entry-row input,
.entry-row textarea,
.entry-row select {
    flex: 1;
}

/* Improved entry settings grid - wider inputs with vertical toggles */
.entry-settings {
    display: grid;
    grid-template-columns: 190px 190px 320px 80px; /* Even wider for better balance */
    gap: var(--space-sm);
    margin-top: var(--space-sm);
    padding-top: var(--space-sm);
    border-top: 1px solid var(--border-primary);
    align-items: start;
}

.setting-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

.setting-group label {
    font-size: var(--font-size-xs);
    font-weight: 500;
    color: var(--text-labels);
}

.setting-group input,
.setting-group select {
    font-size: var(--font-size-sm);
}

/* Vertical toggle column for Constant and Enabled - aligned with inputs */
.setting-group.toggle-column {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    align-items: flex-start;
    margin-top: calc(var(--font-size-xs) + var(--space-xs)); /* Push down to align with inputs */
}

.toggle-label {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: var(--font-size-xs);
    cursor: pointer;
    margin: 0;
}

/* Simplified entry footer - just token count and delete with proper spacing */
.entry-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: var(--space-sm);
    padding-top: var(--space-sm);
    border-top: 1px solid var(--border-primary);
    gap: var(--space-lg); /* Add gap to prevent overlap */
}

.entry-footer .token-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-tertiary);
    background: var(--bg-quaternary);
    padding: 2px 6px;
    border-radius: var(--radius-xs);
    flex-shrink: 0; /* Prevent shrinking */
}

.entry-footer button {
    padding: var(--space-xs);
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0; /* Prevent shrinking */
}

.empty-entries {
    text-align: center;
    padding: var(--space-xl);
    color: var(--text-tertiary);
}

.empty-entries i {
    font-size: 32px;
    margin-bottom: var(--space-md);
    opacity: 0.5;
}

.empty-entries p {
    margin: 0 0 var(--space-xs) 0;
    font-size: var(--font-size-base);
}

.empty-entries small {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
}

.add-entry-section {
    text-align: center;
    padding-top: var(--space-lg);
    border-top: 1px solid var(--border-primary);
}

#character-book-btn.has-entries {
    color: var(--accent-primary);
    border-color: var(--accent-primary);
    background: rgba(184, 149, 107, 0.1);
}

/* Add to your CSS */
#character-expanded-textarea {
    /* Optimize textarea scrolling */
    transform: translateZ(0);
    -webkit-overflow-scrolling: touch;
    will-change: scroll-position; /* Only for scrolling, not contents */
}

.modal-overlay {
    /* Optimize modal rendering */
    transform: translateZ(0);
    backface-visibility: hidden;
}

/* Make tags section span full width */
.tags-section {
    grid-column: 1 / -1;
    margin-top: var(--space-md);
}

/* Make tags input wider */
#edit-tags {
    min-width: 400px;
    width: 100%;
}
